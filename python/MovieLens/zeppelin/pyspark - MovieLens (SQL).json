{"paragraphs":[{"title":"Download and unpack MovieLens archive","text":"%sh\n\n# if [[ -d /tmp/ml-latest ]]; then\n#     rm -fr /tmp/ml-latest\n#     echo \"Removed existing /tmp/ml-latest folder...\"\n# fi\n\nwget -q -O /tmp/ml-latest.zip http://files.grouplens.org/datasets/movielens/ml-latest.zip \necho \"Dowloaded ml-latest.zip ...\"\n\nunzip /tmp/ml-latest.zip -d /tmp/\nrm /tmp/ml-latest.zip\necho \"Unpacked ml-latest.zip ...\"\n\ndir0=/tmp/datalake\ndir1=links\ndir2=movies\ndir3=ratings\ndir4=tags\n\nfor dir in $dir1 $dir2 $dir3 $dir4;do\n    # if [[ -d $dir0/$dir ]];then\n    #   rm -r $dir0/$dir\n    # fi\n    \n    mkdir -p $dir0/$dir\n\n    mv /tmp/ml-latest/$dir.csv $dir0/$dir/\n    echo \"Moved $dir.csv to $dir0/$dir/ ...\"\ndone\n\nrm -r /tmp/ml-latest\necho \"Datalake files created!\"","user":"anonymous","dateUpdated":"2020-04-02T08:44:39+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"title":true,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{"dir":""},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Dowloaded ml-latest.zip ...\nArchive:  /tmp/ml-latest.zip\n   creating: /tmp/ml-latest/\n  inflating: /tmp/ml-latest/links.csv  \n  inflating: /tmp/ml-latest/tags.csv  \n  inflating: /tmp/ml-latest/genome-tags.csv  \n  inflating: /tmp/ml-latest/ratings.csv  \n  inflating: /tmp/ml-latest/README.txt  \n  inflating: /tmp/ml-latest/genome-scores.csv  \n  inflating: /tmp/ml-latest/movies.csv  \nUnpacked ml-latest.zip ...\nMoved links.csv to /tmp/datalake/links/ ...\nMoved movies.csv to /tmp/datalake/movies/ ...\nMoved ratings.csv to /tmp/datalake/ratings/ ...\nMoved tags.csv to /tmp/datalake/tags/ ...\nDatalake files created!\n"}]},"apps":[],"jobName":"paragraph_1584640098467_1357150542","id":"20200319-112035_948031474","dateCreated":"2020-03-19T17:48:18+0000","dateStarted":"2020-04-02T08:44:39+0000","dateFinished":"2020-04-02T08:44:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9742"},{"text":"%sh\n\nls -l /tmp/datalake/","user":"anonymous","dateUpdated":"2020-04-02T08:19:16+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584652418628_-1917944477","id":"20200319-211338_168984312","dateCreated":"2020-03-19T21:13:38+0000","dateStarted":"2020-04-02T08:19:16+0000","dateFinished":"2020-04-02T08:19:16+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9743"},{"text":"%sh\n\n# копируем файлы в HDFS\n\nhdfs dfs -mkdir -p /tmp/datalake/movies\nhdfs dfs -put -p -f -l /tmp/datalake/* /tmp/datalake/","user":"anonymous","dateUpdated":"2020-04-02T08:49:54+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1584652823737_-793084622","id":"20200319-212023_296231600","dateCreated":"2020-03-19T21:20:23+0000","dateStarted":"2020-04-02T08:49:54+0000","dateFinished":"2020-04-02T08:50:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9744"},{"title":"Dataframe -> table","text":"%pyspark\n\ndf = spark.read.format('csv').option('header', 'true').load('hdfs:///tmp/datalake/movies/movies.csv')\ndf.printSchema()\n","user":"anonymous","dateUpdated":"2020-04-02T08:50:06+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"editorHide":false,"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- movieId: string (nullable = true)\n |-- title: string (nullable = true)\n |-- genres: string (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1584640098469_-524090303","id":"20200319-132212_663298911","dateCreated":"2020-03-19T17:48:18+0000","dateStarted":"2020-04-02T08:50:07+0000","dateFinished":"2020-04-02T08:50:07+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9745"},{"text":"%pyspark\n\ndf.show(10, truncate=False)\n","user":"anonymous","dateUpdated":"2020-04-02T08:50:15+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+----------------------------------+-------------------------------------------+\n|movieId|title                             |genres                                     |\n+-------+----------------------------------+-------------------------------------------+\n|1      |Toy Story (1995)                  |Adventure|Animation|Children|Comedy|Fantasy|\n|2      |Jumanji (1995)                    |Adventure|Children|Fantasy                 |\n|3      |Grumpier Old Men (1995)           |Comedy|Romance                             |\n|4      |Waiting to Exhale (1995)          |Comedy|Drama|Romance                       |\n|5      |Father of the Bride Part II (1995)|Comedy                                     |\n|6      |Heat (1995)                       |Action|Crime|Thriller                      |\n|7      |Sabrina (1995)                    |Comedy|Romance                             |\n|8      |Tom and Huck (1995)               |Adventure|Children                         |\n|9      |Sudden Death (1995)               |Action                                     |\n|10     |GoldenEye (1995)                  |Action|Adventure|Thriller                  |\n+-------+----------------------------------+-------------------------------------------+\nonly showing top 10 rows\n\n"}]},"apps":[],"jobName":"paragraph_1584640747258_1887279937","id":"20200319-175907_733148083","dateCreated":"2020-03-19T17:59:07+0000","dateStarted":"2020-04-02T08:50:15+0000","dateFinished":"2020-04-02T08:50:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9746"},{"text":"%pyspark\n\n# регистрация временного объекта\n\ndf.createOrReplaceTempView('movies')\n","user":"anonymous","dateUpdated":"2020-04-02T08:58:20+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1584640098469_1017020132","id":"20200319-141711_2042525745","dateCreated":"2020-03-19T17:48:18+0000","dateStarted":"2020-04-02T08:58:20+0000","dateFinished":"2020-04-02T08:58:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9747"},{"text":"%pyspark\n\nspark.sql('select * from movies limit 5').show()","user":"anonymous","dateUpdated":"2020-04-02T08:58:27+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------------------+--------------------+\n|movieId|               title|              genres|\n+-------+--------------------+--------------------+\n|      1|    Toy Story (1995)|Adventure|Animati...|\n|      2|      Jumanji (1995)|Adventure|Childre...|\n|      3|Grumpier Old Men ...|      Comedy|Romance|\n|      4|Waiting to Exhale...|Comedy|Drama|Romance|\n|      5|Father of the Bri...|              Comedy|\n+-------+--------------------+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1584647269089_90813759","id":"20200319-194749_1386179957","dateCreated":"2020-03-19T19:47:49+0000","dateStarted":"2020-04-02T08:58:28+0000","dateFinished":"2020-04-02T08:58:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9748"},{"text":"%pyspark\n\nspark.sql(\"create database if not exists moviesdb location 'gs://open_data_engineering_school/movies_db'\")","user":"anonymous","dateUpdated":"2020-04-02T09:02:38+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"DataFrame[]\n"}]},"apps":[],"jobName":"paragraph_1585649654969_1316028360","id":"20200331-101414_831160985","dateCreated":"2020-03-31T10:14:14+0000","dateStarted":"2020-04-02T09:02:38+0000","dateFinished":"2020-04-02T09:02:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9749"},{"text":"%pyspark\n\n# альтернативный вариант\n# открытие файла и создание временной таблицы сразу из Spark SQL (внешняя, неуправляемая спарком таблица):\n\nspark.sql('drop table if exists moviesdb.movies')\n\nspark.sql(\"\"\"\ncreate  table moviesdb.movies\n(movieid int, title string, genres string) \n\n\"\"\")\n\n# можно загрузить данные так (управляемая спарком таблица):\n\nspark.sql(\"\"\"\ninsert overwrite table moviesdb.movies\nselect * from movies\n\"\"\")","user":"anonymous","dateUpdated":"2020-04-02T09:08:26+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"DataFrame[]\n"}]},"apps":[],"jobName":"paragraph_1584653306022_-162632496","id":"20200319-212826_1474254035","dateCreated":"2020-03-19T21:28:26+0000","dateStarted":"2020-04-02T09:05:13+0000","dateFinished":"2020-04-02T09:05:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9750"},{"text":"%pyspark\n\nspark.sql(\"select * from moviesdb.movies limit 10\").show()","user":"anonymous","dateUpdated":"2020-04-02T09:05:27+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------------------+--------------------+\n|movieid|               title|              genres|\n+-------+--------------------+--------------------+\n|      1|    Toy Story (1995)|Adventure|Animati...|\n|      2|      Jumanji (1995)|Adventure|Childre...|\n|      3|Grumpier Old Men ...|      Comedy|Romance|\n|      4|Waiting to Exhale...|Comedy|Drama|Romance|\n|      5|Father of the Bri...|              Comedy|\n|      6|         Heat (1995)|Action|Crime|Thri...|\n|      7|      Sabrina (1995)|      Comedy|Romance|\n|      8| Tom and Huck (1995)|  Adventure|Children|\n|      9| Sudden Death (1995)|              Action|\n|     10|    GoldenEye (1995)|Action|Adventure|...|\n+-------+--------------------+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1585648847956_-1219030183","id":"20200331-100047_790535224","dateCreated":"2020-03-31T10:00:47+0000","dateStarted":"2020-04-02T09:05:27+0000","dateFinished":"2020-04-02T09:05:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9751"},{"text":"%pyspark\n\n# короткая форма. обращение сразу к файлу.\n# не хватило опций (\n\ndf_corrupted = spark.sql(\"\"\"\nselect _c0 as movieid, _c1 as title, _c2 as genres from csv.`/tmp/datalake/movies/movies.csv` where _c0<>'movieId'\n\"\"\")\n\ndf_corrupted.show(10)","user":"anonymous","dateUpdated":"2020-04-02T09:11:37+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------------------+--------------------+\n|movieid|               title|              genres|\n+-------+--------------------+--------------------+\n|      1|    Toy Story (1995)|Adventure|Animati...|\n|      2|      Jumanji (1995)|Adventure|Childre...|\n|      3|Grumpier Old Men ...|      Comedy|Romance|\n|      4|Waiting to Exhale...|Comedy|Drama|Romance|\n|      5|Father of the Bri...|              Comedy|\n|      6|         Heat (1995)|Action|Crime|Thri...|\n|      7|      Sabrina (1995)|      Comedy|Romance|\n|      8| Tom and Huck (1995)|  Adventure|Children|\n|      9| Sudden Death (1995)|              Action|\n|     10|    GoldenEye (1995)|Action|Adventure|...|\n+-------+--------------------+--------------------+\nonly showing top 10 rows\n\n"}]},"apps":[],"jobName":"paragraph_1584653979212_-53819529","id":"20200319-213939_936782668","dateCreated":"2020-03-19T21:39:39+0000","dateStarted":"2020-04-02T09:11:38+0000","dateFinished":"2020-04-02T09:11:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9752"},{"text":"%pyspark\n\n# этот код вызовет ошибку\n\nspark.sql(\"delete from movies where movieId = 1 \")\n\n# You can not delete rows from Data Frame because Hadoop follow WORM( write once read many times) instead you can filter out the deleted records in the SQL statement will give you the new data frame","user":"anonymous","dateUpdated":"2020-04-02T09:19:06+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Fail to execute line 3: spark.sql(\"delete from movies where movieId = 1\")\nTraceback (most recent call last):\n  File \"/usr/lib/spark/python/lib/pyspark.zip/pyspark/sql/utils.py\", line 63, in deco\n    return f(*a, **kw)\n  File \"/usr/lib/spark/python/lib/py4j-0.10.7-src.zip/py4j/protocol.py\", line 328, in get_return_value\n    format(target_id, \".\", name), value)\npy4j.protocol.Py4JJavaError: An error occurred while calling o79.sql.\n: org.apache.spark.sql.catalyst.parser.ParseException: \nOperation not allowed: delete from(line 1, pos 0)\n\n== SQL ==\ndelete from movies where movieId = 1\n^^^\n\n\tat org.apache.spark.sql.catalyst.parser.ParserUtils$.operationNotAllowed(ParserUtils.scala:41)\n\tat org.apache.spark.sql.execution.SparkSqlAstBuilder$$anonfun$visitFailNativeCommand$1.apply(SparkSqlParser.scala:1047)\n\tat org.apache.spark.sql.execution.SparkSqlAstBuilder$$anonfun$visitFailNativeCommand$1.apply(SparkSqlParser.scala:1038)\n\tat org.apache.spark.sql.catalyst.parser.ParserUtils$.withOrigin(ParserUtils.scala:108)\n\tat org.apache.spark.sql.execution.SparkSqlAstBuilder.visitFailNativeCommand(SparkSqlParser.scala:1038)\n\tat org.apache.spark.sql.execution.SparkSqlAstBuilder.visitFailNativeCommand(SparkSqlParser.scala:55)\n\tat org.apache.spark.sql.catalyst.parser.SqlBaseParser$FailNativeCommandContext.accept(SqlBaseParser.java:782)\n\tat org.antlr.v4.runtime.tree.AbstractParseTreeVisitor.visit(AbstractParseTreeVisitor.java:18)\n\tat org.apache.spark.sql.catalyst.parser.AstBuilder$$anonfun$visitSingleStatement$1.apply(AstBuilder.scala:72)\n\tat org.apache.spark.sql.catalyst.parser.AstBuilder$$anonfun$visitSingleStatement$1.apply(AstBuilder.scala:72)\n\tat org.apache.spark.sql.catalyst.parser.ParserUtils$.withOrigin(ParserUtils.scala:108)\n\tat org.apache.spark.sql.catalyst.parser.AstBuilder.visitSingleStatement(AstBuilder.scala:71)\n\tat org.apache.spark.sql.catalyst.parser.AbstractSqlParser$$anonfun$parsePlan$1.apply(ParseDriver.scala:70)\n\tat org.apache.spark.sql.catalyst.parser.AbstractSqlParser$$anonfun$parsePlan$1.apply(ParseDriver.scala:69)\n\tat org.apache.spark.sql.catalyst.parser.AbstractSqlParser.parse(ParseDriver.scala:100)\n\tat org.apache.spark.sql.execution.SparkSqlParser.parse(SparkSqlParser.scala:48)\n\tat org.apache.spark.sql.catalyst.parser.AbstractSqlParser.parsePlan(ParseDriver.scala:69)\n\tat org.apache.spark.sql.SparkSession.sql(SparkSession.scala:642)\n\tat sun.reflect.GeneratedMethodAccessor59.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)\n\tat py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)\n\tat py4j.Gateway.invoke(Gateway.java:282)\n\tat py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)\n\tat py4j.commands.CallCommand.execute(CallCommand.java:79)\n\tat py4j.GatewayConnection.run(GatewayConnection.java:238)\n\tat java.lang.Thread.run(Thread.java:748)\n\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-2115944651678443117.py\", line 380, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 3, in <module>\n  File \"/usr/lib/spark/python/lib/pyspark.zip/pyspark/sql/session.py\", line 767, in sql\n    return DataFrame(self._jsparkSession.sql(sqlQuery), self._wrapped)\n  File \"/usr/lib/spark/python/lib/py4j-0.10.7-src.zip/py4j/java_gateway.py\", line 1257, in __call__\n    answer, self.gateway_client, self.target_id, self.name)\n  File \"/usr/lib/spark/python/lib/pyspark.zip/pyspark/sql/utils.py\", line 73, in deco\n    raise ParseException(s.split(': ', 1)[1], stackTrace)\npyspark.sql.utils.ParseException: '\\nOperation not allowed: delete from(line 1, pos 0)\\n\\n== SQL ==\\ndelete from movies where movieId = 1\\n^^^\\n'\n"}]},"apps":[],"jobName":"paragraph_1584656329892_-409646110","id":"20200319-221849_1208821572","dateCreated":"2020-03-19T22:18:49+0000","dateStarted":"2020-04-02T09:15:16+0000","dateFinished":"2020-04-02T09:15:16+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:9753"},{"text":"%pyspark\n\nprint('%table')\nprint('firstname\\tlastname\\tage')\nprint('Timofey\\tGavrilenko\\t39')","user":"anonymous","dateUpdated":"2020-04-02T09:21:23+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"firstname":"string","lastname":"string","age":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"firstname\tlastname\tage\nTimofey\tGavrilenko\t39\n"}]},"apps":[],"jobName":"paragraph_1585819216341_-312903754","id":"20200402-092016_2146228023","dateCreated":"2020-04-02T09:20:16+0000","dateStarted":"2020-04-02T09:21:22+0000","dateFinished":"2020-04-02T09:21:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9754"},{"text":"%spark.sql\n\nselect * from moviesdb.movies limit 5","user":"anonymous","dateUpdated":"2020-04-02T09:19:36+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":208,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"movieid":"string","title":"string","genres":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"stackedAreaChart":{"rotate":{"degree":"-45"}}},"commonSetting":{},"keys":[{"name":"movieid","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"title","index":1,"aggr":"sum"}]},"helium":{}},"1":{"graph":{"mode":"table","height":86,"optionOpen":false}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"movieid\ttitle\tgenres\n1\tToy Story (1995)\tAdventure|Animation|Children|Comedy|Fantasy\n2\tJumanji (1995)\tAdventure|Children|Fantasy\n3\tGrumpier Old Men (1995)\tComedy|Romance\n4\tWaiting to Exhale (1995)\tComedy|Drama|Romance\n5\tFather of the Bride Part II (1995)\tComedy\n"},{"type":"TEXT","data":""}]},"apps":[],"jobName":"paragraph_1584641239258_969989502","id":"20200319-180719_49056139","dateCreated":"2020-03-19T18:07:19+0000","dateStarted":"2020-04-02T09:17:42+0000","dateFinished":"2020-04-02T09:17:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9755"},{"text":"%spark.sql\n\nwith cte1\nas\n(\n    select '(.+)[ ]+\\\\((\\\\d{4})\\\\)' regexp\n),\ncte2\nas\n(\n select\n)\nselect regexp_extract('Toy Story (1995)', regexp, 1) as title,\n       regexp_extract('Toy Story (1995)', regexp, 2) as year\nfrom cte","user":"anonymous","dateUpdated":"2020-04-02T09:29:14+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":88,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"title":"string","year":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"title\tyear\nToy Story\t1995\n"},{"type":"TEXT","data":""}]},"apps":[],"jobName":"paragraph_1584642056992_322697933","id":"20200319-182056_1135975523","dateCreated":"2020-03-19T18:20:56+0000","dateStarted":"2020-04-02T09:25:32+0000","dateFinished":"2020-04-02T09:25:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9756"},{"text":"%pyspark\n\n# create our own sql udf-functions\n\nimport re\n\nspark.udf.register(\"get_title\", lambda x: re.search('(.+)[ ]+\\\\((\\\\d{4})\\\\)', x).group(1))\nspark.udf.register(\"get_year\", lambda x: re.search('(.+)[ ]+\\\\((\\\\d{4})\\\\)', x).group(2))\n\nspark.sql('''\n  select get_title(\"Toy Story (1995)\") as title,\n         get_year(\"Toy Story (1995)\") as year\n''').show()","user":"anonymous","dateUpdated":"2020-04-02T09:41:56+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+----+\n|    title|year|\n+---------+----+\n|Toy Story|1995|\n+---------+----+\n\n"}]},"apps":[],"jobName":"paragraph_1585071793166_1549384047","id":"20200324-174313_257743953","dateCreated":"2020-03-24T17:43:13+0000","dateStarted":"2020-04-02T09:41:56+0000","dateFinished":"2020-04-02T09:41:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9757"},{"text":"%spark.sql\n\nselect split('Adventure|Animation|Children|Comedy|Fantasy', '\\\\|')","user":"anonymous","dateUpdated":"2020-04-02T09:43:30+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":102,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"split(Adventure|Animation|Children|Comedy|Fantasy, \\|)":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"split(Adventure|Animation|Children|Comedy|Fantasy, \\|)\nWrappedArray(Adventure, Animation, Children, Comedy, Fantasy)\n"},{"type":"TEXT","data":""}]},"apps":[],"jobName":"paragraph_1584641842428_-50118877","id":"20200319-181722_1321559168","dateCreated":"2020-03-19T18:17:22+0000","dateStarted":"2020-04-02T09:42:24+0000","dateFinished":"2020-04-02T09:42:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9758"},{"text":"%spark.sql\n\nwith cte\nas\n(\n    select '(.+)[ ]+\\\\((\\\\d{4})\\\\)' regexp\n)\n\nselect regexp_extract(m.title, regexp, 1) as title,\n       regexp_extract(m.title, regexp, 2) as year,\n       explode(split(m.genres, '\\\\|')) as genre\nfrom cte \ncross join movies m\nlimit 10","user":"anonymous","dateUpdated":"2020-04-02T09:44:49+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"title":"string","year":"string","genre":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"title\tyear\tgenre\nToy Story\t1995\tAdventure\nToy Story\t1995\tAnimation\nToy Story\t1995\tChildren\nToy Story\t1995\tComedy\nToy Story\t1995\tFantasy\nJumanji\t1995\tAdventure\nJumanji\t1995\tChildren\nJumanji\t1995\tFantasy\nGrumpier Old Men\t1995\tComedy\nGrumpier Old Men\t1995\tRomance\n"},{"type":"TEXT","data":""}]},"apps":[],"jobName":"paragraph_1584641666106_1497329750","id":"20200319-181426_1609282113","dateCreated":"2020-03-19T18:14:26+0000","dateStarted":"2020-04-02T09:44:49+0000","dateFinished":"2020-04-02T09:44:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9759"},{"text":"%spark.sql\n\nwith cte_reg\nas\n(\n    select '(.+)[ ]+[(](\\\\d{4})[)]' regexp\n),\ncte_wished_genres\nas\n(\n    select explode(split('Comedy|Drama', '[|]')) as genre\n),\ncte_split\nas\n(\n    select m.movieId,\n           regexp_extract(m.title, r.regexp, 1) as title,\n           regexp_extract(m.title, r.regexp, 2) as year,\n           explode(split(m.genres, '[|]')) as genre\n    from cte_reg r \n    cross join movies m\n),\ncte_filtered_ids\nas\n(\n    select s.movieId\n    from cte_split s\n    join cte_wished_genres wg on s.genre = wg.genre\n    where s.year between 2000 and 2005\n        and lower(s.title) like '%love%'\n)\nselect s.title,\n       s.year,\n       s.genre\nfrom cte_split s\nwhere s.movieId in (select movieId from cte_filtered_ids)","user":"anonymous","dateUpdated":"2020-04-02T09:49:17+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"title":"string","year":"string","genre":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"title\tyear\tgenre\nLove and Basketball\t2000\tDrama\nLove and Basketball\t2000\tRomance\nLove's Labour's Lost\t2000\tComedy\nLove's Labour's Lost\t2000\tRomance\nLove & Sex\t2000\tComedy\nLove & Sex\t2000\tDrama\nLove & Sex\t2000\tRomance\nIn the Mood For Love (Fa yeung nin wa)\t2000\tDrama\nIn the Mood For Love (Fa yeung nin wa)\t2000\tRomance\nAmores Perros (Love's a Bitch)\t2000\tDrama\nAmores Perros (Love's a Bitch)\t2000\tThriller\nThomas in Love (Thomas est Amoureux)\t2000\tComedy\nThomas in Love (Thomas est Amoureux)\t2000\tDrama\nBig Bad Love\t2001\tDrama\nTriumph of Love, The\t2001\tComedy\nIn Praise of Love (Éloge de l'amour)\t2001\tDrama\nLovely & Amazing\t2001\tComedy\nLovely & Amazing\t2001\tDrama\nLovely & Amazing\t2001\tRomance\nMad Love (Juana la Loca)\t2001\tDrama\nPunch-Drunk Love\t2002\tComedy\nPunch-Drunk Love\t2002\tDrama\nPunch-Drunk Love\t2002\tRomance\nFood of Love (Manjar de Amor)\t2002\tDrama\nLove In the Time of Money\t2002\tComedy\nLove In the Time of Money\t2002\tDrama\nLove In the Time of Money\t2002\tRomance\nI Love You Too (Ik ook Van Jou)\t2001\tDrama\nI Love You Too (Ik ook Van Jou)\t2001\tRomance\nLove, Honour and Obey\t2000\tComedy\nLove, Honour and Obey\t2000\tCrime\nLove, Honour and Obey\t2000\tDrama\nLove Liza\t2002\tDrama\nKira's Reason: A Love Story (En Kærlighedshistorie)\t2001\tDrama\nDown with Love\t2003\tComedy\nDown with Love\t2003\tRomance\nLove the Hard Way\t2001\tCrime\nLove the Hard Way\t2001\tDrama\nLove the Hard Way\t2001\tRomance\nLoco Love (Mi Casa, Su Casa)\t2002\tComedy\nPossible Loves (Amores Possíveis)\t2000\tComedy\nPossible Loves (Amores Possíveis)\t2000\tRomance\nDemonlover\t2002\tCrime\nDemonlover\t2002\tDrama\nDemonlover\t2002\tMystery\nDemonlover\t2002\tThriller\nUnconditional Love\t2002\tComedy\nUnconditional Love\t2002\tDrama\nLove Actually\t2003\tComedy\nLove Actually\t2003\tDrama\nLove Actually\t2003\tRomance\nLove Forbidden (Défense d'aimer)\t2002\tDrama\nLove Don't Cost a Thing\t2003\tDrama\nLove Don't Cost a Thing\t2003\tRomance\nLove Life\t2001\tComedy\nLove Life\t2001\tRomance\nDe-Lovely\t2004\tDrama\nDe-Lovely\t2004\tMusical\nEnduring Love\t2004\tDrama\nIt's All About Love\t2003\tDrama\nIt's All About Love\t2003\tRomance\nIt's All About Love\t2003\tSci-Fi\nIt's All About Love\t2003\tThriller\nLove Me If You Dare (Jeux d'enfants)\t2003\tDrama\nLove Me If You Dare (Jeux d'enfants)\t2003\tRomance\nFor Love or Country: The Arturo Sandoval Story\t2000\tDrama\nFor Love or Country: The Arturo Sandoval Story\t2000\tMusical\nLove Object\t2003\tComedy\nLove Object\t2003\tDrama\nLove Object\t2003\tHorror\nLove Object\t2003\tRomance\nLove Object\t2003\tThriller\nWhen Will I Be Loved\t2004\tDrama\nLove Song for Bobby Long, A\t2004\tDrama\nLove Comes Softly\t2003\tDrama\nLove Comes Softly\t2003\tRomance\nLove Comes Softly\t2003\tWestern\nLot Like Love, A\t2005\tComedy\nLot Like Love, A\t2005\tDrama\nLot Like Love, A\t2005\tRomance\nDirty Filthy Love\t2004\tDrama\nDirty Filthy Love\t2004\tRomance\nMy Summer of Love\t2004\tDrama\nMy Summer of Love\t2004\tRomance\nMust Love Dogs\t2005\tComedy\nMust Love Dogs\t2005\tRomance\nBook of Love\t2004\tComedy\nBook of Love\t2004\tDrama\nDirty Love\t2005\tComedy\nDirty Love\t2005\tRomance\nLove's Enduring Promise\t2004\tDrama\nLove's Enduring Promise\t2004\tRomance\nI Love Your Work\t2003\tDrama\nI Love Your Work\t2003\tMystery\nLollilove\t2004\tComedy\nCombien Tu M'aimes? (How Much Do You Love Me?)\t2005\tComedy\nCombien Tu M'aimes? (How Much Do You Love Me?)\t2005\tRomance\nConsequences of Love, The (Conseguenze dell'amore, Le)\t2004\tCrime\nConsequences of Love, The (Conseguenze dell'amore, Le)\t2004\tDrama\nRegular Lovers (Amants réguliers, Les)\t2005\tDrama\nCrying Out Love in the Center of the World (Sekai no chûshin de, ai o sakebu)\t2004\tDrama\nCrying Out Love in the Center of the World (Sekai no chûshin de, ai o sakebu)\t2004\tRomance\nLove\t2005\tCrime\nLove\t2005\tDrama\nLove\t2005\tThriller\nBad Luck Love\t2000\tCrime\nBad Luck Love\t2000\tDrama\nLove Hina Christmas Special: Silent Eve (Rabu Hina kurisumasu supesharu: Sairento ivu)\t2000\tAnimation\nLove Hina Christmas Special: Silent Eve (Rabu Hina kurisumasu supesharu: Sairento ivu)\t2000\tComedy\nLove Hina Christmas Special: Silent Eve (Rabu Hina kurisumasu supesharu: Sairento ivu)\t2000\tRomance\nLove Hina Spring Special\t2001\tAnimation\nLove Hina Spring Special\t2001\tComedy\nLove Hina Spring Special\t2001\tMusical\nLove Hina Spring Special\t2001\tRomance\nHero: Love Story of a Spy, The\t2003\tAction\nHero: Love Story of a Spy, The\t2003\tAdventure\nHero: Love Story of a Spy, The\t2003\tDrama\nHero: Love Story of a Spy, The\t2003\tMusical\nHero: Love Story of a Spy, The\t2003\tRomance\nHero: Love Story of a Spy, The\t2003\tThriller\nHero: Love Story of a Spy, The\t2003\tWar\nLucky: No Time For Love\t2005\tAction\nLucky: No Time For Love\t2005\tAdventure\nLucky: No Time For Love\t2005\tDrama\nLucky: No Time For Love\t2005\tMusical\nLucky: No Time For Love\t2005\tRomance\nLucky: No Time For Love\t2005\tThriller\nLucky: No Time For Love\t2005\tWar\nLove's Long Journey\t2005\tDrama\nLove's Long Journey\t2005\tRomance\nLove's Long Journey\t2005\tWestern\nGames of Love and Chance (L'esquive)\t2003\tDrama\nGames of Love and Chance (L'esquive)\t2003\tRomance\nLovers & Leavers (Kuutamolla)\t2002\tDrama\nLovers & Leavers (Kuutamolla)\t2002\tRomance\nTo Paint or Make Love (Peindre ou faire l'amour)\t2005\tComedy\nFirst Love\t2004\tDrama\nFirst Love\t2004\tRomance\nMagic Gloves, The (Los guantes mágicos)\t2003\tComedy\nMagic Gloves, The (Los guantes mágicos)\t2003\tDrama\nLove That Boy\t2003\tComedy\nLove That Boy\t2003\tRomance\nLove Torn in Dream (Combat d'amour en songe)\t2000\tDrama\nLove Torn in Dream (Combat d'amour en songe)\t2000\tFantasy\nUnexpected Love, An\t2003\tDrama\nMarie-Jo and Her 2 Lovers (Marie-Jo et ses 2 amours)\t2002\tComedy\nMarie-Jo and Her 2 Lovers (Marie-Jo et ses 2 amours)\t2002\tDrama\nTransistor Love Story (Monrak Transistor)\t2001\tComedy\nTransistor Love Story (Monrak Transistor)\t2001\tDrama\nTransistor Love Story (Monrak Transistor)\t2001\tMusical\nTransistor Love Story (Monrak Transistor)\t2001\tRomance\nTruth About Love, The\t2005\tComedy\nTruth About Love, The\t2005\tRomance\nLove Wrecked\t2005\tComedy\nLove Wrecked\t2005\tRomance\nLove Hina Again\t2002\tAnimation\nLove Hina Again\t2002\tComedy\nLove Hina Again\t2002\tDrama\nNot Here to Be Loved (Je ne suis pas là pour être aimé)\t2005\tDrama\nNot Here to Be Loved (Je ne suis pas là pour être aimé)\t2005\tRomance\nStep Up Love Story (Futari ecchi)\t2002\tAnimation\nStep Up Love Story (Futari ecchi)\t2002\tComedy\nStep Up Love Story (Futari ecchi)\t2002\tRomance\nReality of Love, The (I Want to Marry Ryan Banks)\t2004\tComedy\nReality of Love, The (I Want to Marry Ryan Banks)\t2004\tRomance\nOtakus in Love\t2004\tComedy\nOtakus in Love\t2004\tDrama\nOtakus in Love\t2004\tRomance\nLove is Eternal While It Lasts\t2004\tComedy\nLove is Eternal While It Lasts\t2004\tRomance\nLove, Money, Love\t2000\tDrama\nLove, Money, Love\t2000\tRomance\nThe Courage to Love\t2000\tDrama\nThe Courage to Love\t2000\tRomance\nLove on the Side\t2004\tComedy\nLove on the Side\t2004\tRomance\nLove is God\t2003\tAdventure\nLove is God\t2003\tComedy\nLove is God\t2003\tDrama\nSexaholix... A Love Story\t2002\tComedy\nThe Road To Love\t2001\tDrama\nYoung Love\t2001\tDrama\nYoung Love\t2001\tRomance\nSemen, a Love Sample\t2005\tComedy\nSemen, a Love Sample\t2005\tRomance\nLove Ke Liye Kuch Bhi Karega\t2001\tComedy\nEK Chotti Si Love Story\t2002\tDrama\nA Love Movie\t2003\tDrama\nThe Quiet Love\t2005\tDrama\nThe Quiet Love\t2005\tRomance\nLoverboy\t2003\tDrama\nLove at 16\t2004\tComedy\nLove Hurt's\t2002\tDrama\nLove Hurt's\t2002\tRomance\nJust a Question of Love\t2000\tDrama\nJust a Question of Love\t2000\tRomance\nPerhaps Love\t2005\tDrama\nPerhaps Love\t2005\tRomance\nLoverboy\t2005\tDrama\nLoverboy\t2005\tRomance\nOne Love\t2003\tDrama\nOne Love\t2003\tRomance\nManual of Love\t2005\tComedy\nManual of Love\t2005\tDrama\nManual of Love\t2005\tRomance\nA Love to Hide\t2005\tDrama\nThe Sweet Sex and Love\t2003\tDrama\nThe Sweet Sex and Love\t2003\tRomance\nFaust: Love of the Damned\t2001\tAction\nFaust: Love of the Damned\t2001\tDrama\nFaust: Love of the Damned\t2001\tFantasy\nFaust: Love of the Damned\t2001\tHorror\nFaust: Love of the Damned\t2001\tSci-Fi\nFaust: Love of the Damned\t2001\tThriller\nFrom Mesmer, with Love or Tea for Two\t2002\tDrama\n"},{"type":"TEXT","data":""}]},"apps":[],"jobName":"paragraph_1584645356437_-1528966305","id":"20200319-191556_1634688355","dateCreated":"2020-03-19T19:15:56+0000","dateStarted":"2020-04-02T09:49:18+0000","dateFinished":"2020-04-02T09:49:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9760"},{"text":"%pyspark\n\ndf_filtered = spark.sql(\"\"\"\nwith cte_reg\nas\n(\n    select '(.+)[ ]+[(](\\\\\\d{4})[)]' regexp\n),\ncte_wished_genres\nas\n(\n    select explode(split('Comedy|Drama', '[|]')) as genre\n),\ncte_split\nas\n(\n    select m.movieId,\n           regexp_extract(m.title, r.regexp, 1) as title,\n           regexp_extract(m.title, r.regexp, 2) as year,\n           explode(split(m.genres, '[|]')) as genre\n    from cte_reg r \n    cross join movies m\n),\ncte_filtered_ids\nas\n(\n    select s.movieId\n    from cte_split s\n    join cte_wished_genres wg on s.genre = wg.genre\n    where s.year between 2000 and 2005\n        and lower(s.title) like '%love%'\n)\nselect s.title,\n       s.year,\n       s.genre\nfrom cte_split s\nwhere s.movieId in (select movieId from cte_filtered_ids)\n\"\"\")","user":"anonymous","dateUpdated":"2020-04-02T09:50:45+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1584658996718_-1230456589","id":"20200319-230316_211226499","dateCreated":"2020-03-19T23:03:16+0000","dateStarted":"2020-04-02T09:50:45+0000","dateFinished":"2020-04-02T09:50:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9761"},{"text":"%pyspark\n\ndf_filtered.show()","user":"anonymous","dateUpdated":"2020-04-02T09:50:48+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+----+--------+\n|               title|year|   genre|\n+--------------------+----+--------+\n| Love and Basketball|2000|   Drama|\n| Love and Basketball|2000| Romance|\n|Love's Labour's Lost|2000|  Comedy|\n|Love's Labour's Lost|2000| Romance|\n|          Love & Sex|2000|  Comedy|\n|          Love & Sex|2000|   Drama|\n|          Love & Sex|2000| Romance|\n|In the Mood For L...|2000|   Drama|\n|In the Mood For L...|2000| Romance|\n|Amores Perros (Lo...|2000|   Drama|\n|Amores Perros (Lo...|2000|Thriller|\n|Thomas in Love (T...|2000|  Comedy|\n|Thomas in Love (T...|2000|   Drama|\n|        Big Bad Love|2001|   Drama|\n|Triumph of Love, The|2001|  Comedy|\n|In Praise of Love...|2001|   Drama|\n|    Lovely & Amazing|2001|  Comedy|\n|    Lovely & Amazing|2001|   Drama|\n|    Lovely & Amazing|2001| Romance|\n|Mad Love (Juana l...|2001|   Drama|\n+--------------------+----+--------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1584659711327_-1199334640","id":"20200319-231511_1332657462","dateCreated":"2020-03-19T23:15:11+0000","dateStarted":"2020-04-02T09:50:48+0000","dateFinished":"2020-04-02T09:50:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9762"},{"text":"%pyspark\n\ndf_filtered.write.mode('overwrite').format('csv').save('hdfs:///tmp/movies/map-filter')\n","user":"anonymous","dateUpdated":"2020-04-02T08:36:17+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584640098472_763613421","id":"20200319-142023_878496530","dateCreated":"2020-03-19T17:48:18+0000","dateStarted":"2020-04-02T08:36:17+0000","dateFinished":"2020-04-02T08:36:19+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9763"},{"text":"%sh\n\nhdfs dfs -ls /tmp/movies/map-filter","user":"anonymous","dateUpdated":"2020-04-02T08:36:23+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584640098473_1718281555","id":"20200319-145426_1497762152","dateCreated":"2020-03-19T17:48:18+0000","dateStarted":"2020-04-02T08:36:23+0000","dateFinished":"2020-04-02T08:36:26+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9764"},{"text":"%sh\n\n# в полученном файле нет заголовка; делимитер, кодировка и пр - по умолчанию\n# кроме того, нет ни партиционирования, ни бакетинга\n\nhdfs dfs -cat /tmp/movies/map-filter/* | head ","user":"anonymous","dateUpdated":"2020-03-24T08:38:40+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584685525566_-714924535","id":"20200320-062525_122000815","dateCreated":"2020-03-20T06:25:25+0000","dateStarted":"2020-03-21T09:17:12+0000","dateFinished":"2020-03-21T09:17:15+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9765"},{"text":"%pyspark\n\ndf_filtered.write.mode('overwrite') \\\n    .format('csv') \\\n    .partitionBy('genre') \\\n    .option('header', 'true') \\\n    .option('delimiter', ';') \\\n    .option('encoding', 'utf-8') \\\n    .option('path', 'hdfs:///tmp/movies/map-filter') \\\n    .saveAsTable('movies_mapped_and_filtered')\n    \n# дополнительно можно было создать бакеты, например 10шт по колонке year: .bucketBy(10, 'year') \\\n\n# в будущем можно будет обновлять файлы только в тех партициях (фолдерах) на диске, которые соответствуют данным в датафрейме\n# spark.conf.set(\"spark.sql.sources.partitionOverwriteMode\",\"dynamic\")\n# df_filtered.write.insertInto(\"movies_mapped_and_filtered\", overwrite=True)","user":"anonymous","dateUpdated":"2020-04-02T08:37:43+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584685920749_-124346268","id":"20200320-063200_1353818257","dateCreated":"2020-03-20T06:32:00+0000","dateStarted":"2020-04-02T08:37:43+0000","dateFinished":"2020-04-02T08:37:47+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9766"},{"text":"%sql\n\n-- также можно будет обрабатывать только те файлы, которым соответствует фильтр запроса\nexplain  select * from movies_mapped_and_filtered where genre in ('Drama', 'Comedy')","user":"anonymous","dateUpdated":"2020-04-02T08:37:51+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"plan":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584785953655_1554230162","id":"20200321-101913_1010139433","dateCreated":"2020-03-21T10:19:13+0000","dateStarted":"2020-04-02T08:37:51+0000","dateFinished":"2020-04-02T08:37:51+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9767"},{"text":"%sh\n\n# в полученном файле нет заголовка; делимитер, кодировка и пр - по умолчанию\n# кроме того, нет ни партиционирования, ни бакетинга\n\nhdfs dfs -ls /tmp/movies/map-filter ","user":"anonymous","dateUpdated":"2020-03-24T08:38:41+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584693066723_-1842774880","id":"20200320-083106_1300551503","dateCreated":"2020-03-20T08:31:06+0000","dateStarted":"2020-03-22T16:28:26+0000","dateFinished":"2020-03-22T16:28:30+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9768"},{"text":"%sh\n\nhdfs dfs -ls /tmp/movies/map-filter/genre=Action\n\nhdfs dfs -cat /tmp/movies/map-filter/genre=Action/*","user":"anonymous","dateUpdated":"2020-03-24T08:38:41+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584782727349_-1353850749","id":"20200321-092527_1015542665","dateCreated":"2020-03-21T09:25:27+0000","dateStarted":"2020-03-21T09:27:46+0000","dateFinished":"2020-03-21T09:27:52+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9769"},{"text":"%sql\n\nselect genre, map('title', title, 'year', year) as movie\nfrom movies_mapped_and_filtered\nlimit 10","user":"anonymous","dateUpdated":"2020-04-02T10:03:27+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"genre":"string","movie":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"genre\tmovie\nDrama\tMap(title -> Love and Basketball, year -> 2000)\nDrama\tMap(title -> Love & Sex, year -> 2000)\nDrama\tMap(title -> In the Mood For Love (Fa yeung nin wa), year -> 2000)\nDrama\tMap(title -> Amores Perros (Love's a Bitch), year -> 2000)\nDrama\tMap(title -> Thomas in Love (Thomas est Amoureux), year -> 2000)\nDrama\tMap(title -> Big Bad Love, year -> 2001)\nDrama\tMap(title -> In Praise of Love (Éloge de l'amour), year -> 2001)\nDrama\tMap(title -> Lovely & Amazing, year -> 2001)\nDrama\tMap(title -> Mad Love (Juana la Loca), year -> 2001)\nDrama\tMap(title -> Punch-Drunk Love, year -> 2002)\n"},{"type":"TEXT","data":""}]},"apps":[],"jobName":"paragraph_1584784752070_-1192384144","id":"20200321-095912_1827079652","dateCreated":"2020-03-21T09:59:12+0000","dateStarted":"2020-04-02T10:03:27+0000","dateFinished":"2020-04-02T10:03:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9770"},{"text":"%sql\n\nselect genre, collect_list(to_json(map('title', title, 'year', year))) as movies\nfrom movies_mapped_and_filtered\ngroup by genre","user":"anonymous","dateUpdated":"2020-04-02T10:04:01+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"genre":"string","movies":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"genre\tmovies\nCrime\tWrappedArray({\"title\":\"Love, Honour and Obey\",\"year\":\"2000\"}, {\"title\":\"Love the Hard Way\",\"year\":\"2001\"}, {\"title\":\"Demonlover\",\"year\":\"2002\"}, {\"title\":\"Consequences of Love, The (Conseguenze dell'amore, Le)\",\"year\":\"2004\"}, {\"title\":\"Love\",\"year\":\"2005\"}, {\"title\":\"Bad Luck Love\",\"year\":\"2000\"})\nRomance\tWrappedArray({\"title\":\"Love and Basketball\",\"year\":\"2000\"}, {\"title\":\"Love's Labour's Lost\",\"year\":\"2000\"}, {\"title\":\"Love & Sex\",\"year\":\"2000\"}, {\"title\":\"In the Mood For Love (Fa yeung nin wa)\",\"year\":\"2000\"}, {\"title\":\"Lovely & Amazing\",\"year\":\"2001\"}, {\"title\":\"Punch-Drunk Love\",\"year\":\"2002\"}, {\"title\":\"Love In the Time of Money\",\"year\":\"2002\"}, {\"title\":\"I Love You Too (Ik ook Van Jou)\",\"year\":\"2001\"}, {\"title\":\"Down with Love\",\"year\":\"2003\"}, {\"title\":\"Love the Hard Way\",\"year\":\"2001\"}, {\"title\":\"Possible Loves (Amores Possíveis)\",\"year\":\"2000\"}, {\"title\":\"Love Actually\",\"year\":\"2003\"}, {\"title\":\"Love Don't Cost a Thing\",\"year\":\"2003\"}, {\"title\":\"Love Life\",\"year\":\"2001\"}, {\"title\":\"It's All About Love\",\"year\":\"2003\"}, {\"title\":\"Love Me If You Dare (Jeux d'enfants)\",\"year\":\"2003\"}, {\"title\":\"Love Object\",\"year\":\"2003\"}, {\"title\":\"Love Comes Softly\",\"year\":\"2003\"}, {\"title\":\"Lot Like Love, A\",\"year\":\"2005\"}, {\"title\":\"Dirty Filthy Love\",\"year\":\"2004\"}, {\"title\":\"My Summer of Love\",\"year\":\"2004\"}, {\"title\":\"Must Love Dogs\",\"year\":\"2005\"}, {\"title\":\"Dirty Love\",\"year\":\"2005\"}, {\"title\":\"Love's Enduring Promise\",\"year\":\"2004\"}, {\"title\":\"Combien Tu M'aimes? (How Much Do You Love Me?)\",\"year\":\"2005\"}, {\"title\":\"Crying Out Love in the Center of the World (Sekai no chûshin de, ai o sakebu)\",\"year\":\"2004\"}, {\"title\":\"Love Hina Christmas Special: Silent Eve (Rabu Hina kurisumasu supesharu: Sairento ivu)\",\"year\":\"2000\"}, {\"title\":\"Love Hina Spring Special\",\"year\":\"2001\"}, {\"title\":\"Hero: Love Story of a Spy, The\",\"year\":\"2003\"}, {\"title\":\"Lucky: No Time For Love\",\"year\":\"2005\"}, {\"title\":\"Love's Long Journey\",\"year\":\"2005\"}, {\"title\":\"Games of Love and Chance (L'esquive)\",\"year\":\"2003\"}, {\"title\":\"Lovers & Leavers (Kuutamolla)\",\"year\":\"2002\"}, {\"title\":\"First Love\",\"year\":\"2004\"}, {\"title\":\"Love That Boy\",\"year\":\"2003\"}, {\"title\":\"Transistor Love Story (Monrak Transistor)\",\"year\":\"2001\"}, {\"title\":\"Truth About Love, The\",\"year\":\"2005\"}, {\"title\":\"Love Wrecked\",\"year\":\"2005\"}, {\"title\":\"Not Here to Be Loved (Je ne suis pas là pour être aimé)\",\"year\":\"2005\"}, {\"title\":\"Step Up Love Story (Futari ecchi)\",\"year\":\"2002\"}, {\"title\":\"Reality of Love, The (I Want to Marry Ryan Banks)\",\"year\":\"2004\"}, {\"title\":\"Otakus in Love\",\"year\":\"2004\"}, {\"title\":\"Love is Eternal While It Lasts\",\"year\":\"2004\"}, {\"title\":\"Love, Money, Love\",\"year\":\"2000\"}, {\"title\":\"The Courage to Love\",\"year\":\"2000\"}, {\"title\":\"Love on the Side\",\"year\":\"2004\"}, {\"title\":\"Young Love\",\"year\":\"2001\"}, {\"title\":\"Semen, a Love Sample\",\"year\":\"2005\"}, {\"title\":\"The Quiet Love\",\"year\":\"2005\"}, {\"title\":\"Love Hurt's\",\"year\":\"2002\"}, {\"title\":\"Just a Question of Love\",\"year\":\"2000\"}, {\"title\":\"Perhaps Love\",\"year\":\"2005\"}, {\"title\":\"Loverboy\",\"year\":\"2005\"}, {\"title\":\"One Love\",\"year\":\"2003\"}, {\"title\":\"Manual of Love\",\"year\":\"2005\"}, {\"title\":\"The Sweet Sex and Love\",\"year\":\"2003\"})\nThriller\tWrappedArray({\"title\":\"Amores Perros (Love's a Bitch)\",\"year\":\"2000\"}, {\"title\":\"Demonlover\",\"year\":\"2002\"}, {\"title\":\"It's All About Love\",\"year\":\"2003\"}, {\"title\":\"Love Object\",\"year\":\"2003\"}, {\"title\":\"Love\",\"year\":\"2005\"}, {\"title\":\"Hero: Love Story of a Spy, The\",\"year\":\"2003\"}, {\"title\":\"Lucky: No Time For Love\",\"year\":\"2005\"}, {\"title\":\"Faust: Love of the Damned\",\"year\":\"2001\"})\nAdventure\tWrappedArray({\"title\":\"Hero: Love Story of a Spy, The\",\"year\":\"2003\"}, {\"title\":\"Lucky: No Time For Love\",\"year\":\"2005\"}, {\"title\":\"Love is God\",\"year\":\"2003\"})\nDrama\tWrappedArray({\"title\":\"Love and Basketball\",\"year\":\"2000\"}, {\"title\":\"Love & Sex\",\"year\":\"2000\"}, {\"title\":\"In the Mood For Love (Fa yeung nin wa)\",\"year\":\"2000\"}, {\"title\":\"Amores Perros (Love's a Bitch)\",\"year\":\"2000\"}, {\"title\":\"Thomas in Love (Thomas est Amoureux)\",\"year\":\"2000\"}, {\"title\":\"Big Bad Love\",\"year\":\"2001\"}, {\"title\":\"In Praise of Love (Éloge de l'amour)\",\"year\":\"2001\"}, {\"title\":\"Lovely & Amazing\",\"year\":\"2001\"}, {\"title\":\"Mad Love (Juana la Loca)\",\"year\":\"2001\"}, {\"title\":\"Punch-Drunk Love\",\"year\":\"2002\"}, {\"title\":\"Food of Love (Manjar de Amor)\",\"year\":\"2002\"}, {\"title\":\"Love In the Time of Money\",\"year\":\"2002\"}, {\"title\":\"I Love You Too (Ik ook Van Jou)\",\"year\":\"2001\"}, {\"title\":\"Love, Honour and Obey\",\"year\":\"2000\"}, {\"title\":\"Love Liza\",\"year\":\"2002\"}, {\"title\":\"Kira's Reason: A Love Story (En Kærlighedshistorie)\",\"year\":\"2001\"}, {\"title\":\"Love the Hard Way\",\"year\":\"2001\"}, {\"title\":\"Demonlover\",\"year\":\"2002\"}, {\"title\":\"Unconditional Love\",\"year\":\"2002\"}, {\"title\":\"Love Actually\",\"year\":\"2003\"}, {\"title\":\"Love Forbidden (Défense d'aimer)\",\"year\":\"2002\"}, {\"title\":\"Love Don't Cost a Thing\",\"year\":\"2003\"}, {\"title\":\"De-Lovely\",\"year\":\"2004\"}, {\"title\":\"Enduring Love\",\"year\":\"2004\"}, {\"title\":\"It's All About Love\",\"year\":\"2003\"}, {\"title\":\"Love Me If You Dare (Jeux d'enfants)\",\"year\":\"2003\"}, {\"title\":\"For Love or Country: The Arturo Sandoval Story\",\"year\":\"2000\"}, {\"title\":\"Love Object\",\"year\":\"2003\"}, {\"title\":\"When Will I Be Loved\",\"year\":\"2004\"}, {\"title\":\"Love Song for Bobby Long, A\",\"year\":\"2004\"}, {\"title\":\"Love Comes Softly\",\"year\":\"2003\"}, {\"title\":\"Lot Like Love, A\",\"year\":\"2005\"}, {\"title\":\"Dirty Filthy Love\",\"year\":\"2004\"}, {\"title\":\"My Summer of Love\",\"year\":\"2004\"}, {\"title\":\"Book of Love\",\"year\":\"2004\"}, {\"title\":\"Love's Enduring Promise\",\"year\":\"2004\"}, {\"title\":\"I Love Your Work\",\"year\":\"2003\"}, {\"title\":\"Consequences of Love, The (Conseguenze dell'amore, Le)\",\"year\":\"2004\"}, {\"title\":\"Regular Lovers (Amants réguliers, Les)\",\"year\":\"2005\"}, {\"title\":\"Crying Out Love in the Center of the World (Sekai no chûshin de, ai o sakebu)\",\"year\":\"2004\"}, {\"title\":\"Love\",\"year\":\"2005\"}, {\"title\":\"Bad Luck Love\",\"year\":\"2000\"}, {\"title\":\"Hero: Love Story of a Spy, The\",\"year\":\"2003\"}, {\"title\":\"Lucky: No Time For Love\",\"year\":\"2005\"}, {\"title\":\"Love's Long Journey\",\"year\":\"2005\"}, {\"title\":\"Games of Love and Chance (L'esquive)\",\"year\":\"2003\"}, {\"title\":\"Lovers & Leavers (Kuutamolla)\",\"year\":\"2002\"}, {\"title\":\"First Love\",\"year\":\"2004\"}, {\"title\":\"Magic Gloves, The (Los guantes mágicos)\",\"year\":\"2003\"}, {\"title\":\"Love Torn in Dream (Combat d'amour en songe)\",\"year\":\"2000\"}, {\"title\":\"Unexpected Love, An\",\"year\":\"2003\"}, {\"title\":\"Marie-Jo and Her 2 Lovers (Marie-Jo et ses 2 amours)\",\"year\":\"2002\"}, {\"title\":\"Transistor Love Story (Monrak Transistor)\",\"year\":\"2001\"}, {\"title\":\"Love Hina Again\",\"year\":\"2002\"}, {\"title\":\"Not Here to Be Loved (Je ne suis pas là pour être aimé)\",\"year\":\"2005\"}, {\"title\":\"Otakus in Love\",\"year\":\"2004\"}, {\"title\":\"Love, Money, Love\",\"year\":\"2000\"}, {\"title\":\"The Courage to Love\",\"year\":\"2000\"}, {\"title\":\"Love is God\",\"year\":\"2003\"}, {\"title\":\"The Road To Love\",\"year\":\"2001\"}, {\"title\":\"Young Love\",\"year\":\"2001\"}, {\"title\":\"EK Chotti Si Love Story\",\"year\":\"2002\"}, {\"title\":\"A Love Movie\",\"year\":\"2003\"}, {\"title\":\"The Quiet Love\",\"year\":\"2005\"}, {\"title\":\"Loverboy\",\"year\":\"2003\"}, {\"title\":\"Love Hurt's\",\"year\":\"2002\"}, {\"title\":\"Just a Question of Love\",\"year\":\"2000\"}, {\"title\":\"Perhaps Love\",\"year\":\"2005\"}, {\"title\":\"Loverboy\",\"year\":\"2005\"}, {\"title\":\"One Love\",\"year\":\"2003\"}, {\"title\":\"Manual of Love\",\"year\":\"2005\"}, {\"title\":\"A Love to Hide\",\"year\":\"2005\"}, {\"title\":\"The Sweet Sex and Love\",\"year\":\"2003\"}, {\"title\":\"Faust: Love of the Damned\",\"year\":\"2001\"}, {\"title\":\"From Mesmer, with Love or Tea for Two\",\"year\":\"2002\"})\nWar\tWrappedArray({\"title\":\"Hero: Love Story of a Spy, The\",\"year\":\"2003\"}, {\"title\":\"Lucky: No Time For Love\",\"year\":\"2005\"})\nFantasy\tWrappedArray({\"title\":\"Love Torn in Dream (Combat d'amour en songe)\",\"year\":\"2000\"}, {\"title\":\"Faust: Love of the Damned\",\"year\":\"2001\"})\nMystery\tWrappedArray({\"title\":\"Demonlover\",\"year\":\"2002\"}, {\"title\":\"I Love Your Work\",\"year\":\"2003\"})\nMusical\tWrappedArray({\"title\":\"De-Lovely\",\"year\":\"2004\"}, {\"title\":\"For Love or Country: The Arturo Sandoval Story\",\"year\":\"2000\"}, {\"title\":\"Love Hina Spring Special\",\"year\":\"2001\"}, {\"title\":\"Hero: Love Story of a Spy, The\",\"year\":\"2003\"}, {\"title\":\"Lucky: No Time For Love\",\"year\":\"2005\"}, {\"title\":\"Transistor Love Story (Monrak Transistor)\",\"year\":\"2001\"})\nAnimation\tWrappedArray({\"title\":\"Love Hina Christmas Special: Silent Eve (Rabu Hina kurisumasu supesharu: Sairento ivu)\",\"year\":\"2000\"}, {\"title\":\"Love Hina Spring Special\",\"year\":\"2001\"}, {\"title\":\"Love Hina Again\",\"year\":\"2002\"}, {\"title\":\"Step Up Love Story (Futari ecchi)\",\"year\":\"2002\"})\nHorror\tWrappedArray({\"title\":\"Love Object\",\"year\":\"2003\"}, {\"title\":\"Faust: Love of the Damned\",\"year\":\"2001\"})\nWestern\tWrappedArray({\"title\":\"Love Comes Softly\",\"year\":\"2003\"}, {\"title\":\"Love's Long Journey\",\"year\":\"2005\"})\nComedy\tWrappedArray({\"title\":\"Love's Labour's Lost\",\"year\":\"2000\"}, {\"title\":\"Love & Sex\",\"year\":\"2000\"}, {\"title\":\"Thomas in Love (Thomas est Amoureux)\",\"year\":\"2000\"}, {\"title\":\"Triumph of Love, The\",\"year\":\"2001\"}, {\"title\":\"Lovely & Amazing\",\"year\":\"2001\"}, {\"title\":\"Punch-Drunk Love\",\"year\":\"2002\"}, {\"title\":\"Love In the Time of Money\",\"year\":\"2002\"}, {\"title\":\"Love, Honour and Obey\",\"year\":\"2000\"}, {\"title\":\"Down with Love\",\"year\":\"2003\"}, {\"title\":\"Loco Love (Mi Casa, Su Casa)\",\"year\":\"2002\"}, {\"title\":\"Possible Loves (Amores Possíveis)\",\"year\":\"2000\"}, {\"title\":\"Unconditional Love\",\"year\":\"2002\"}, {\"title\":\"Love Actually\",\"year\":\"2003\"}, {\"title\":\"Love Life\",\"year\":\"2001\"}, {\"title\":\"Love Object\",\"year\":\"2003\"}, {\"title\":\"Lot Like Love, A\",\"year\":\"2005\"}, {\"title\":\"Must Love Dogs\",\"year\":\"2005\"}, {\"title\":\"Book of Love\",\"year\":\"2004\"}, {\"title\":\"Dirty Love\",\"year\":\"2005\"}, {\"title\":\"Lollilove\",\"year\":\"2004\"}, {\"title\":\"Combien Tu M'aimes? (How Much Do You Love Me?)\",\"year\":\"2005\"}, {\"title\":\"Love Hina Christmas Special: Silent Eve (Rabu Hina kurisumasu supesharu: Sairento ivu)\",\"year\":\"2000\"}, {\"title\":\"Love Hina Spring Special\",\"year\":\"2001\"}, {\"title\":\"To Paint or Make Love (Peindre ou faire l'amour)\",\"year\":\"2005\"}, {\"title\":\"Magic Gloves, The (Los guantes mágicos)\",\"year\":\"2003\"}, {\"title\":\"Love That Boy\",\"year\":\"2003\"}, {\"title\":\"Marie-Jo and Her 2 Lovers (Marie-Jo et ses 2 amours)\",\"year\":\"2002\"}, {\"title\":\"Transistor Love Story (Monrak Transistor)\",\"year\":\"2001\"}, {\"title\":\"Truth About Love, The\",\"year\":\"2005\"}, {\"title\":\"Love Wrecked\",\"year\":\"2005\"}, {\"title\":\"Love Hina Again\",\"year\":\"2002\"}, {\"title\":\"Step Up Love Story (Futari ecchi)\",\"year\":\"2002\"}, {\"title\":\"Reality of Love, The (I Want to Marry Ryan Banks)\",\"year\":\"2004\"}, {\"title\":\"Otakus in Love\",\"year\":\"2004\"}, {\"title\":\"Love is Eternal While It Lasts\",\"year\":\"2004\"}, {\"title\":\"Love on the Side\",\"year\":\"2004\"}, {\"title\":\"Love is God\",\"year\":\"2003\"}, {\"title\":\"Sexaholix... A Love Story\",\"year\":\"2002\"}, {\"title\":\"Semen, a Love Sample\",\"year\":\"2005\"}, {\"title\":\"Love Ke Liye Kuch Bhi Karega\",\"year\":\"2001\"}, {\"title\":\"Love at 16\",\"year\":\"2004\"}, {\"title\":\"Manual of Love\",\"year\":\"2005\"})\nAction\tWrappedArray({\"title\":\"Hero: Love Story of a Spy, The\",\"year\":\"2003\"}, {\"title\":\"Lucky: No Time For Love\",\"year\":\"2005\"}, {\"title\":\"Faust: Love of the Damned\",\"year\":\"2001\"})\nSci-Fi\tWrappedArray({\"title\":\"It's All About Love\",\"year\":\"2003\"}, {\"title\":\"Faust: Love of the Damned\",\"year\":\"2001\"})\n"},{"type":"TEXT","data":""}]},"apps":[],"jobName":"paragraph_1584784914345_-1759614995","id":"20200321-100154_1017654242","dateCreated":"2020-03-21T10:01:54+0000","dateStarted":"2020-04-02T10:04:01+0000","dateFinished":"2020-04-02T10:04:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9771"},{"text":"%sql\n\ndrop table if exists movies_result_list\n","user":"anonymous","dateUpdated":"2020-04-02T09:52:55+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{}},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":""},{"type":"TEXT","data":""}]},"apps":[],"jobName":"paragraph_1584788450565_1892419089","id":"20200321-110050_538595157","dateCreated":"2020-03-21T11:00:50+0000","dateStarted":"2020-04-02T09:52:55+0000","dateFinished":"2020-04-02T09:52:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9772"},{"text":"%sql\n\ncreate table movies_result_list\nusing json\nlocation '/tmp/movies/map-filter-reduce'\nas\n(\n   select genre, collect_list(map('title', title, 'year', year)) as movies\n   from movies_mapped_and_filtered\n   group by genre\n)\n","user":"anonymous","dateUpdated":"2020-04-02T09:53:30+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{}},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":""},{"type":"TEXT","data":""}]},"apps":[],"jobName":"paragraph_1584788464327_1180400512","id":"20200321-110104_1110722128","dateCreated":"2020-03-21T11:01:04+0000","dateStarted":"2020-04-02T09:53:31+0000","dateFinished":"2020-04-02T09:53:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9773"},{"text":"%sh\n\nhdfs dfs -ls /tmp/movies/map-filter-reduce","user":"anonymous","dateUpdated":"2020-04-02T09:53:54+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Found 17 items\n-rw-r--r--   1 zeppelin hadoop          0 2020-04-02 09:53 /tmp/movies/map-filter-reduce/_SUCCESS\n-rw-r--r--   1 zeppelin hadoop          0 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00000-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop        310 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00008-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop       2854 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00010-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop        400 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00014-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop        178 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00033-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop       3794 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00045-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop        134 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00050-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop        154 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00076-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop        111 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00106-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop        366 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00113-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop        299 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00118-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop        120 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00160-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop        121 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00169-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop       2164 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00178-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop        189 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00183-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n-rw-r--r--   1 zeppelin hadoop        128 2020-04-02 09:53 /tmp/movies/map-filter-reduce/part-00193-897552fe-ba7e-49b2-ac3b-c4a62c8d7c0f-c000.json\n"}]},"apps":[],"jobName":"paragraph_1584789423539_27692405","id":"20200321-111703_1323062342","dateCreated":"2020-03-21T11:17:03+0000","dateStarted":"2020-04-02T09:53:54+0000","dateFinished":"2020-04-02T09:53:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9774"},{"text":"%sh\nhdfs dfs -cat /tmp/movies/map-filter-reduce/*008*","user":"anonymous","dateUpdated":"2020-04-02T09:54:52+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"{\"genre\":\"Crime\",\"movies\":[{\"title\":\"Love, Honour and Obey\",\"year\":\"2000\"},{\"title\":\"Love the Hard Way\",\"year\":\"2001\"},{\"title\":\"Demonlover\",\"year\":\"2002\"},{\"title\":\"Consequences of Love, The (Conseguenze dell'amore, Le)\",\"year\":\"2004\"},{\"title\":\"Love\",\"year\":\"2005\"},{\"title\":\"Bad Luck Love\",\"year\":\"2000\"}]}\n"}]},"apps":[],"jobName":"paragraph_1585821272467_-82439542","id":"20200402-095432_123670606","dateCreated":"2020-04-02T09:54:32+0000","dateStarted":"2020-04-02T09:54:52+0000","dateFinished":"2020-04-02T09:54:54+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9775"},{"text":"%sql\n\n-- альтернативный вариант (в этой редакции в будущем придется парсить строку-json)\n\ncreate table if not exists movies_result\n(\n    genre  varchar(20),\n    movies string\n)\nusing json\n\n","user":"anonymous","dateUpdated":"2020-04-02T08:40:27+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584783873423_527244799","id":"20200321-094433_1727710228","dateCreated":"2020-03-21T09:44:33+0000","dateStarted":"2020-04-02T08:40:27+0000","dateFinished":"2020-04-02T08:40:28+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9776"},{"text":"%sql\n\ninsert overwrite table movies_result\n   select genre, collect_list(to_json(map('title', title, 'year', year))) as movies\n   from movies_mapped_and_filtered\n   group by genre","user":"anonymous","dateUpdated":"2020-04-02T08:41:22+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{}},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584788842218_-1345339592","id":"20200321-110722_1860836951","dateCreated":"2020-03-21T11:07:22+0000","dateStarted":"2020-04-02T08:41:22+0000","dateFinished":"2020-04-02T08:41:25+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9777"},{"text":"%sql\n\nselect * from movies_result","user":"anonymous","dateUpdated":"2020-04-02T08:40:42+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"genre":"string","movies":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584789265463_1581832","id":"20200321-111425_567520007","dateCreated":"2020-03-21T11:14:25+0000","dateStarted":"2020-04-02T08:40:42+0000","dateFinished":"2020-04-02T08:40:42+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9778"},{"text":"%sql\n\n-- еще один вариант, без создания таблицы\n\ninsert overwrite directory\nusing json   \noptions (path '/tmp/movies/map-filter-reduce2')\n   select genre, collect_list(map('title', title, 'year', year)) as movies\n   from movies_mapped_and_filtered\n   group by genre\n","user":"anonymous","dateUpdated":"2020-04-02T10:06:16+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{}},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":""},{"type":"TEXT","data":""}]},"apps":[],"jobName":"paragraph_1584904764534_-1419538294","id":"20200322-191924_106675922","dateCreated":"2020-03-22T19:19:24+0000","dateStarted":"2020-04-02T10:06:16+0000","dateFinished":"2020-04-02T10:06:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9779"},{"text":"%sh\n\nhdfs dfs -ls /tmp/movies/map-filter-reduce2","user":"anonymous","dateUpdated":"2020-04-02T10:06:23+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Found 17 items\n-rw-r--r--   1 zeppelin hadoop          0 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/_SUCCESS\n-rw-r--r--   1 zeppelin hadoop          0 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00000-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop        310 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00008-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop       2854 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00010-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop        400 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00014-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop        178 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00033-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop       3794 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00045-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop        134 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00050-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop        154 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00076-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop        111 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00106-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop        366 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00113-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop        299 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00118-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop        120 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00160-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop        121 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00169-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop       2164 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00178-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop        189 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00183-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n-rw-r--r--   1 zeppelin hadoop        128 2020-04-02 10:06 /tmp/movies/map-filter-reduce2/part-00193-cf4588c6-8ff2-4358-8879-968ee5232065-c000.json\n"}]},"apps":[],"jobName":"paragraph_1584904973816_-1481411457","id":"20200322-192253_1273614096","dateCreated":"2020-03-22T19:22:53+0000","dateStarted":"2020-04-02T10:06:24+0000","dateFinished":"2020-04-02T10:06:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9780"},{"text":"%sh\n\nhdfs dfs -cat /tmp/movies/map-filter-reduce2/*008*","user":"anonymous","dateUpdated":"2020-03-24T08:38:50+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584905067549_-1800963191","id":"20200322-192427_524029139","dateCreated":"2020-03-22T19:24:27+0000","dateStarted":"2020-03-22T19:25:12+0000","dateFinished":"2020-03-22T19:25:16+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9781"},{"title":"Constraints and limitations of Spark SQL","text":"%sql\n\n-- exception:\n\ndelete from movies_result where year < 2000\n\n--truncate table movies_result is ok\n","user":"anonymous","dateUpdated":"2020-04-02T10:07:32+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","title":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"\nOperation not allowed: delete from(line 3, pos 0)\n\n== SQL ==\n-- exception:\n\ndelete from movies_result where year < 2000\n^^^\n\n--truncate table movies_result is ok\n\nset zeppelin.spark.sql.stacktrace = true to see full stacktrace"}]},"apps":[],"jobName":"paragraph_1584788609728_348257565","id":"20200321-110329_1484038185","dateCreated":"2020-03-21T11:03:29+0000","dateStarted":"2020-04-02T10:07:32+0000","dateFinished":"2020-04-02T10:07:32+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:9782"},{"text":"%sql\n\n-- обходной путь для delete\n\ncreate table tmp_movies_result like movies_result;\n\ninsert into tmp_movies_result\nselect * from movies_result \nwhere not (year < 2000);\n\ninsert overwrite movies_result\nselect * from tmp_movies_result;\n\ndrop table tmp_movies_result","user":"anonymous","dateUpdated":"2020-04-02T10:10:46+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"\nmismatched input ';' expecting <EOF>(line 3, pos 49)\n\n== SQL ==\n-- обходной путь для delete\n\ncreate table tmp_movies_result like movies_result;\n-------------------------------------------------^^^\n\ninsert into tmp_movies_result\nselect * from movies_result \nwhere not (year < 2000);\n\ninsert overwrite movies_result\nselect * from tmp_movies_result;\n\ndrop table tmp_movies_result\n\nset zeppelin.spark.sql.stacktrace = true to see full stacktrace"}]},"apps":[],"jobName":"paragraph_1584907255764_136712600","id":"20200322-200055_1228465546","dateCreated":"2020-03-22T20:00:55+0000","dateStarted":"2020-04-02T10:10:47+0000","dateFinished":"2020-04-02T10:10:47+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:9783"},{"text":"%sql\n\n-- exception:\n\nupdate movies_result\n  set title = title +'***'\nwhere year = 2000\n\n-- solution is similar to one with temp table provided above","user":"anonymous","dateUpdated":"2020-03-24T08:38:50+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584905175331_-2129306610","id":"20200322-192615_638768716","dateCreated":"2020-03-22T19:26:15+0000","dateStarted":"2020-03-22T19:45:28+0000","dateFinished":"2020-03-22T19:45:28+0000","status":"ERROR","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9784"},{"text":"%sql\n\n--drop table if exists tmp_movies_result;\n\n--create table tmp_movies_result(genre string, movies array<string>)\n--clustered by(genre) into 3 buckets\n--stored as orc\n--tblproperties ('transactional'='true')","user":"anonymous","dateUpdated":"2020-04-02T08:44:13+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{}},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584906217223_-1720678666","id":"20200322-194337_376488455","dateCreated":"2020-03-22T19:43:37+0000","dateStarted":"2020-04-02T08:43:52+0000","dateFinished":"2020-04-02T08:43:52+0000","status":"ERROR","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9785"},{"title":"Full Pure SQL-code","text":"create database if not exists movies_db\r\nlocation 'gs://open_data_engineering_school/movies_db';\r\n\r\nuse movies_db;\r\n\r\n---------------------------------------------------------------\r\n\r\ndrop view if exists movies;\r\n\r\ncreate temporary view movies \r\n(\r\n   movieid int, \r\n   title string, \r\n   genres string\r\n) \r\nusing csv \r\noptions(\r\n        header = true, \r\n        path   = 'hdfs:///tmp/datalake/movies/movies.csv'\r\n       );\r\n\r\n---------------------------------------------------------------\r\n\r\ncreate table if not exists movies_mapped_and_filtered (\r\n   title string,\r\n   year  int,\r\n   genre string\r\n)\r\nusing csv\r\npartitioned by(genre);\r\n--option(\r\n--       header    = true,\r\n--       delimiter = ';',\r\n--       encoding  = 'utf-8'       \r\n--       path      = 'hdfs:///tmp/movies/map-filter'\r\n--      );\r\n\r\n\r\nwith cte_reg\r\nas\r\n(\r\n    select '(.+)[ ]+[(](\\\\d{4})[)]' regexp\r\n),\r\ncte_wished_genres\r\nas\r\n(\r\n    select explode(split('Comedy|Drama', '[|]')) as genre\r\n),\r\ncte_split\r\nas\r\n(\r\n    select m.movieId,\r\n           regexp_extract(m.title, r.regexp, 1) as title,\r\n           regexp_extract(m.title, r.regexp, 2) as year,\r\n           explode(split(m.genres, '[|]')) as genre\r\n    from cte_reg r \r\n    cross join movies m\r\n),\r\ncte_filtered_ids\r\nas\r\n(\r\n    select s.movieId\r\n    from cte_split s\r\n    join cte_wished_genres wg on s.genre = wg.genre\r\n    where s.year between 2000 and 2005\r\n        and lower(s.title) like '%love%'\r\n)\r\ninsert overwrite table movies_mapped_and_filtered\r\nselect s.title,\r\n       s.year,\r\n       s.genre\r\nfrom cte_split s\r\nwhere s.movieId in (select movieId from cte_filtered_ids);\r\n\r\n---------------------------------------------------------------\r\ndrop table if exists movies_result_list;\r\n\r\ncreate table movies_result_list\r\nusing json\r\n--location 'hdfs:///tmp/movies/map-filter-reduce'\r\nas\r\n(\r\n   select genre, collect_list(map('title', title, 'year', year)) as movies\r\n   from movies_mapped_and_filtered\r\n   group by genre\r\n);\r\n","user":"anonymous","dateUpdated":"2020-03-24T08:38:51+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","editorHide":false,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1584911914532_961591420","id":"20200322-211834_1593929812","dateCreated":"2020-03-22T21:18:34+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9786"}],"name":"pyspark - MovieLens (SQL)","id":"2F4F4M54B","noteParams":{},"noteForms":{},"angularObjects":{"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}